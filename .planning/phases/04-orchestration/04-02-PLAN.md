---
phase: 04-orchestration
plan: 02
type: execute
---

<objective>
Implement prompt template system using Handlebars for rendering issue context into prompts.

Purpose: Load prompt templates from the prompts/ directory and render them with issue-specific context (number, title, body, branch name, worktree path) so Claude receives a well-formatted prompt.
Output: `src/templates.rs` with TemplateEngine struct and Handlebars integration.
</objective>

<execution_context>
@~/.claude/plugins/cache/taches-cc-resources/taches-cc-resources/1.0.0/skills/create-plans/workflows/execute-phase.md
@~/.claude/plugins/cache/taches-cc-resources/taches-cc-resources/1.0.0/skills/create-plans/templates/summary.md
</execution_context>

<context>
@.planning/BRIEF.md
@.planning/ROADMAP.md
@.planning/phases/04-orchestration/04-01-SUMMARY.md
@src/config.rs
@src/github.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Handlebars dependency and create TemplateEngine</name>
  <files>Cargo.toml, src/templates.rs, src/main.rs</files>
  <action>
Add to Cargo.toml dependencies:
- handlebars = "6" (latest major version)

Create src/templates.rs with:
- `TemplateEngine` struct containing: handlebars: Handlebars<'static>, templates_dir: PathBuf
- `IssueContext` struct (derives Serialize) with fields: issue_number (u64), title (String), body (String), branch_name (String), worktree_path (String), html_url (String)
- `TemplateEngine::new(config: &PromptsConfig) -> Result<Self>` that:
  - Creates Handlebars instance with strict mode enabled (fail on missing variables)
  - Stores templates_dir from config
- `TemplateEngine::load_template(&mut self, name: &str) -> Result<()>` that registers a template from file
- Use handlebars.register_template_file() for loading

Add `mod templates;` to main.rs.
  </action>
  <verify>cargo build compiles without errors</verify>
  <done>Handlebars added to Cargo.toml, TemplateEngine struct created with new() and load_template()</done>
</task>

<task type="auto">
  <name>Task 2: Implement template rendering with issue context</name>
  <files>src/templates.rs, prompts/new_issue.md</files>
  <action>
Add to src/templates.rs:
- `TemplateEngine::render(&self, template_name: &str, context: &IssueContext) -> Result<String>` that renders a registered template with the context
- `IssueContext::from_issue(issue: &Issue, branch_name: &str, worktree_path: &Path) -> Self` helper to construct context from Issue struct

Create example template file prompts/new_issue.md (create prompts/ dir if needed):
```
# Issue #{{issue_number}}: {{title}}

{{body}}

---

You are working in: `{{worktree_path}}`
Branch: `{{branch_name}}`
Issue URL: {{html_url}}

Please implement the changes described above. When done, commit your changes with a descriptive message referencing issue #{{issue_number}}.
```

This template serves as the default prompt for new issues. Users can customize it.
  </action>
  <verify>cargo build compiles, template file exists at prompts/new_issue.md</verify>
  <done>render() method works, example template created, IssueContext::from_issue() helper exists</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cargo build` succeeds without errors
- [ ] `cargo clippy` has no errors
- [ ] prompts/new_issue.md exists with Handlebars placeholders
- [ ] TemplateEngine can load and render templates
- [ ] IssueContext contains all necessary fields for prompt rendering
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Template system is ready for use by Claude invocation
</success_criteria>

<output>
After completion, create `.planning/phases/04-orchestration/04-02-SUMMARY.md`
</output>
