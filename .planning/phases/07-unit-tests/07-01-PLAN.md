---
phase: 07-unit-tests
type: execute
---

<objective>
Add unit tests for the config module covering TOML parsing, defaults, and validation.

Purpose: Ensure config parsing is robust and catches invalid configurations early.
Output: Comprehensive test suite for config.rs with ~90% coverage of pure functions.
</objective>

<execution_context>
@~/.claude/skills/create-plans/workflows/execute-phase.md
@~/.claude/skills/create-plans/templates/summary.md
</execution_context>

<context>
@.planning/BRIEF.md
@.planning/ROADMAP.md
@src/config.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add TOML parsing tests</name>
  <files>src/config.rs</files>
  <action>Add test module with tests for:
  - Minimal config (only required fields: github.owner, github.repo) parses correctly with defaults applied
  - Full config (all fields specified) parses correctly
  - Invalid TOML syntax returns parse error
  - Missing required fields (owner/repo) returns error
  Use toml::from_str directly to test parsing without filesystem. Create test fixtures as const &str.</action>
  <verify>cargo test config::tests -- --nocapture shows all parsing tests pass</verify>
  <done>4+ tests covering minimal, full, invalid syntax, and missing fields scenarios</done>
</task>

<task type="auto">
  <name>Task 2: Add defaults verification tests</name>
  <files>src/config.rs</files>
  <action>Add tests verifying all default values:
  - token_env defaults to "GITHUB_TOKEN"
  - All 5 labels default to "pleb:ready", "pleb:provisioning", etc.
  - claude.command defaults to "claude"
  - claude.args defaults to ["--dangerously-skip-permissions"]
  - poll_interval_secs defaults to 5
  - session_name defaults to "pleb"
  Parse a minimal config and assert each default value explicitly.</action>
  <verify>cargo test config::tests::test_defaults -- --nocapture passes</verify>
  <done>Test explicitly asserts all 10+ default values</done>
</task>

<task type="auto">
  <name>Task 3: Add validation logic tests</name>
  <files>src/config.rs</files>
  <action>Add tests for validate() logic (excluding filesystem checks):
  - Empty github.owner fails validation
  - Empty github.repo fails validation
  - Empty token_env fails validation
  - Duplicate labels (e.g., ready == done) fails with "Label conflict" error
  - poll_interval_secs = 0 fails validation
  Note: Skip filesystem validation tests (prompts.dir exists, etc.) as those require integration tests.</action>
  <verify>cargo test config::tests::test_validation -- --nocapture passes</verify>
  <done>5+ validation tests covering empty fields and label conflicts</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `cargo test config::tests` passes with 10+ tests
- [ ] `cargo build` succeeds without warnings
- [ ] Each test tests a single specific behavior
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No compiler warnings introduced
- Config module has comprehensive unit test coverage for pure logic
</success_criteria>

<output>
After completion, create `.planning/phases/07-unit-tests/07-01-SUMMARY.md`
</output>
