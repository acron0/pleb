---
phase: 07-unit-tests
type: execute
---

<objective>
Add unit tests for IssueContext construction and expand existing test coverage.

Purpose: Complete unit test coverage for all pure functions across the codebase.
Output: Tests for templates module + expanded coverage in existing test modules.
</objective>

<execution_context>
@~/.claude/skills/create-plans/workflows/execute-phase.md
@~/.claude/skills/create-plans/templates/summary.md
</execution_context>

<context>
@.planning/BRIEF.md
@.planning/ROADMAP.md
@src/templates.rs
@src/state.rs
@src/commands.rs
@src/hooks.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add IssueContext unit tests</name>
  <files>src/templates.rs</files>
  <action>Add test module with tests for IssueContext::from_issue():
  - Construct an Issue struct manually (issue_number, title, body, html_url)
  - Call from_issue() with branch_name and worktree_path
  - Assert all fields are correctly populated in the resulting IssueContext
  - Test with various edge cases: empty body, long title, special characters in path
  Note: TemplateEngine tests require filesystem (handlebars file loading), skip those for unit tests.</action>
  <verify>cargo test templates::tests -- --nocapture passes</verify>
  <done>3+ tests covering normal construction and edge cases</done>
</task>

<task type="auto">
  <name>Task 2: Expand state.rs test coverage</name>
  <files>src/state.rs</files>
  <action>Review existing tests and add coverage for:
  - PlebState::from_str parsing (if FromStr is implemented)
  - PlebState display/serialize format
  - can_transition_to() method if it exists
  - Any state comparison or equality checks
  Goal: Every public method on PlebState has at least one test.</action>
  <verify>cargo test state::tests -- --nocapture passes with expanded tests</verify>
  <done>Existing tests + any gaps in public method coverage filled</done>
</task>

<task type="auto">
  <name>Task 3: Review and finalize test suite</name>
  <files>src/lib.rs (if exists), Cargo.toml</files>
  <action>
  - Run cargo test and verify all tests pass
  - Check for any #[allow(dead_code)] on tested functions and remove if now tested
  - Ensure test output is clean (no warnings, deprecations)
  - Add #[cfg(test)] compilation guards are properly placed
  </action>
  <verify>cargo test passes with 0 warnings, cargo clippy passes</verify>
  <done>Full test suite runs clean, no warnings or clippy issues</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `cargo test` passes all tests (15+ total across all modules)
- [ ] `cargo clippy` passes without warnings
- [ ] `cargo build` succeeds without warnings
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Every pure function in the codebase has at least one unit test
- Test suite is clean and maintainable
</success_criteria>

<output>
After completion, create `.planning/phases/07-unit-tests/07-02-SUMMARY.md`
</output>
