---
phase: 11-pr-merge-cleanup
plan: 01
type: execute
---

<objective>
Add the "finished" state foundation - config and state machine support.

Purpose: Enable tracking of issues whose PRs have been merged, distinct from "done" (PR created but not yet merged).
Output: Config supports `labels.finished`, PlebState has `Finished` variant, all mappings updated.
</objective>

<execution_context>
@~/.claude/plugins/cache/taches-cc-resources/taches-cc-resources/1.0.0/skills/create-plans/workflows/execute-phase.md
@~/.claude/plugins/cache/taches-cc-resources/taches-cc-resources/1.0.0/skills/create-plans/templates/summary.md
</execution_context>

<context>
@.planning/BRIEF.md
@.planning/ROADMAP.md
@src/config.rs
@src/state.rs
@src/github.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add finished label to LabelConfig</name>
  <files>src/config.rs</files>
  <action>
    1. Add `finished` field to `LabelConfig` struct with serde default
    2. Add `default_label_finished()` function returning "pleb:finished"
    3. Update label validation in `Config::validate()` to include `finished` in the uniqueness check
    4. Update test configs (MINIMAL_CONFIG, FULL_CONFIG) to include the new field
    5. Add test for custom finished label parsing
  </action>
  <verify>cargo test --lib config:: -- --nocapture</verify>
  <done>LabelConfig has finished field, defaults to "pleb:finished", validation includes it, tests pass</done>
</task>

<task type="auto">
  <name>Task 2: Add Finished state to PlebState</name>
  <files>src/state.rs, src/github.rs, src/main.rs</files>
  <action>
    1. Add `Finished` variant to `PlebState` enum in state.rs
    2. Update `valid_transitions()`: Working/Waiting/Done can all transition to Finished (PR can merge from any active state)
    3. Update `is_terminal()` - Finished is terminal (no transitions out)
    4. In github.rs: Update `state_to_label()` to map `Finished` to `config.labels.finished`
    5. In github.rs: Update `get_pleb_state()` to detect finished label
    6. In main.rs `parse_state()`: Add "finished" string parsing
    7. In main.rs `handle_transition_command()`: Include finished label in "none" removal list
    8. Add unit tests for new state transitions
  </action>
  <verify>cargo test --lib state:: && cargo test --lib -- --nocapture</verify>
  <done>Finished state exists, transitions are valid from working/waiting/done, all mappings work, tests pass</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cargo build` succeeds without errors
- [ ] `cargo test` passes all tests
- [ ] `cargo clippy` has no warnings
- [ ] Manual test: `pleb transition <issue> finished` works (if you have a test issue)
</verification>

<success_criteria>
- LabelConfig includes `finished` with default "pleb:finished"
- PlebState::Finished exists and is a terminal state
- Transitions to Finished are valid from Working, Waiting, and Done
- All label/state mappings updated consistently
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/11-pr-merge-cleanup/11-01-SUMMARY.md`
</output>
