---
phase: 05-hooks-and-skills
plan: 02
type: execute
---

<objective>
Create slash commands for pleb-managed projects that Claude and users can invoke.

Purpose: Provide convenient commands for common workflow actions: shipping work, abandoning issues, and checking status.
Output: `/pleb-shipit`, `/pleb-abandon`, and `/pleb-status` slash command files, plus generation/installation mechanism.
</objective>

<execution_context>
@~/.claude/plugins/cache/taches-cc-resources/taches-cc-resources/1.0.0/skills/create-plans/workflows/execute-phase.md
@~/.claude/plugins/cache/taches-cc-resources/taches-cc-resources/1.0.0/skills/create-plans/templates/summary.md
</execution_context>

<context>
@.planning/BRIEF.md
@.planning/ROADMAP.md
@.planning/phases/05-hooks-and-skills/05-01-SUMMARY.md
@src/cli.rs
@src/main.rs
@src/hooks.rs
@src/github.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create `/pleb-shipit` slash command</name>
  <files>src/commands.rs (new), src/main.rs, src/cli.rs</files>
  <action>
Create new `src/commands.rs` module with:
- `PLEB_SHIPIT_COMMAND` constant containing the slash command markdown:
  ```markdown
  # Ship It

  Create a pull request for the current work and mark the issue as done.

  ## Steps
  1. Stage and commit any uncommitted changes with a descriptive message
  2. Push the current branch to origin
  3. Create a pull request using `gh pr create`:
     - Title: Use the issue title or branch name
     - Body: Reference the issue number (Closes #XXX)
  4. Run: `pleb transition <issue-number> done`
  5. Report the PR URL to the user

  ## Context
  - Working directory: Current worktree (contains issue number in path)
  - Branch: Already created by pleb (pleb/issue-XXX)
  - Issue number: Extract from current directory path

  ## Important
  - If there are no changes to commit, skip step 1
  - If PR already exists for this branch, report existing PR instead of creating new one
  - Always transition to done state after PR is created/found
  ```

- `generate_command_file(name: &str) -> String` function that returns command content
- Command files go in `.claude/commands/` directory

Add to hooks.rs `install_hooks()` or create new `install_commands()`:
- Create `.claude/commands/` directory if needed
- Write `pleb-shipit.md` file

Extend `pleb hooks install` to also install commands (or add separate `pleb commands install`).
  </action>
  <verify>
After install, `.claude/commands/pleb-shipit.md` exists with correct content; `/pleb-shipit` is recognized by Claude Code
  </verify>
  <done>
`/pleb-shipit` command available in pleb-managed worktrees, creates PR and transitions to done
  </done>
</task>

<task type="auto">
  <name>Task 2: Create `/pleb-abandon` slash command</name>
  <files>src/commands.rs</files>
  <action>
Add `PLEB_ABANDON_COMMAND` constant to commands.rs:
```markdown
# Abandon Issue

Give up on the current issue and clean up.

## Steps
1. Extract issue number from current directory path (worktree path contains issue-XXX)
2. Remove all pleb labels from the issue using:
   ```bash
   pleb transition <issue-number> none
   ```
   (Note: "none" is a special state that removes all pleb:* labels)
3. Optionally: Ask user if they want to delete the worktree and close the tmux window
4. Report that the issue has been abandoned and is no longer managed by pleb

## Context
- The issue will remain open on GitHub but won't have any pleb labels
- User can manually re-add `pleb:ready` label to restart work later
- Worktree cleanup is optional to preserve any useful partial work
```

Update `install_commands()` to write `pleb-abandon.md`.

Note: Need to add "none" as a valid state in `pleb transition` that removes all pleb:* labels instead of adding one.
  </action>
  <verify>
`.claude/commands/pleb-abandon.md` exists; `/pleb-abandon` removes all pleb labels from issue
  </verify>
  <done>
`/pleb-abandon` command available, removes all pleb labels from current issue
  </done>
</task>

<task type="auto">
  <name>Task 3: Create `/pleb-status` slash command</name>
  <files>src/commands.rs, src/cli.rs, src/main.rs</files>
  <action>
Add `PLEB_STATUS_COMMAND` constant to commands.rs:
```markdown
# Pleb Status

Show the current pleb state for this issue.

## Steps
1. Extract issue number from current directory path
2. Run: `pleb status <issue-number>`
3. Display the output to the user

## Output Format
The command will show:
- Issue number and title
- Current pleb state (ready/provisioning/waiting/working/done or "not managed")
- GitHub issue URL
```

Add `pleb status <issue-number>` CLI command:
- Fetches issue from GitHub API
- Checks which pleb:* label is present
- Prints formatted status:
  ```
  Issue #123: Fix the login bug
  State: working
  URL: https://github.com/owner/repo/issues/123
  ```
- If no pleb label: "State: not managed by pleb"

Update `install_commands()` to write `pleb-status.md`.
  </action>
  <verify>
`pleb status 123` shows issue state; `.claude/commands/pleb-status.md` exists; `/pleb-status` works in Claude Code
  </verify>
  <done>
`/pleb-status` command available, shows current pleb state for the issue
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cargo build` succeeds without errors
- [ ] `cargo test` passes
- [ ] `pleb hooks install` creates all three command files in `.claude/commands/`
- [ ] `pleb status <issue>` shows correct state from GitHub
- [ ] `pleb transition <issue> none` removes all pleb labels
- [ ] Command markdown files have correct content and formatting
</verification>

<success_criteria>
- All three slash commands installed in pleb-managed worktrees
- `/pleb-shipit` creates PR and marks done
- `/pleb-abandon` removes all pleb labels
- `/pleb-status` shows current state
- Commands auto-installed during provisioning (along with hooks)
</success_criteria>

<output>
After completion, create `.planning/phases/05-hooks-and-skills/05-02-SUMMARY.md`

This completes Phase 5: Hooks & Skills.
</output>
