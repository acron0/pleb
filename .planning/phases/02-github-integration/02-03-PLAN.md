---
phase: 02-github-integration
plan: 03
type: execute
---

<objective>
Implement label management for issues with state transition helpers.

Purpose: Enable Pleb to update issue labels as work progresses through states.
Output: Can add/remove labels, with convenient state transition methods.
</objective>

<execution_context>
@~/.claude/plugins/cache/taches-cc-resources/taches-cc-resources/1.0.0/skills/create-plans/workflows/execute-phase.md
@~/.claude/plugins/cache/taches-cc-resources/taches-cc-resources/1.0.0/skills/create-plans/templates/summary.md
</execution_context>

<context>
@.planning/BRIEF.md
@.planning/ROADMAP.md
@.planning/phases/02-github-integration/02-02-SUMMARY.md
@src/github.rs
@src/config.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add/remove label methods</name>
  <files>src/github.rs</files>
  <action>
    Add label management methods to GitHubClient:

    ```rust
    impl GitHubClient {
      /// Add a label to an issue
      pub async fn add_label(&self, issue_number: u64, label: &str) -> Result<()> {
        // Use octocrab to add label
        // POST /repos/{owner}/{repo}/issues/{issue_number}/labels
      }

      /// Remove a label from an issue
      pub async fn remove_label(&self, issue_number: u64, label: &str) -> Result<()> {
        // Use octocrab to remove label
        // DELETE /repos/{owner}/{repo}/issues/{issue_number}/labels/{label}
        // Handle case where label doesn't exist (not an error)
      }

      /// Replace one label with another (atomic state transition)
      pub async fn replace_label(&self, issue_number: u64, old_label: &str, new_label: &str) -> Result<()> {
        // Remove old, add new
        // Do both even if remove fails (label might not exist)
      }
    }
    ```

    Avoid: Don't use octocrab's set_labels which replaces ALL labels.
    Why: We only manage pleb: labels, user might have other labels on the issue.
  </action>
  <verify>
    - cargo build succeeds
    - Methods compile without errors
  </verify>
  <done>Can add and remove individual labels on issues</done>
</task>

<task type="auto">
  <name>Task 2: State transition helpers</name>
  <files>src/github.rs, src/config.rs</files>
  <action>
    Add PlebState enum and transition methods:

    ```rust
    #[derive(Debug, Clone, Copy, PartialEq)]
    pub enum PlebState {
      Ready,
      Provisioning,
      Waiting,
      Working,
      Done,
    }

    impl GitHubClient {
      /// Transition an issue from one pleb state to another
      pub async fn transition_state(
        &self,
        issue_number: u64,
        from: PlebState,
        to: PlebState,
        labels_config: &LabelConfig,
      ) -> Result<()> {
        let old_label = self.state_to_label(from, labels_config);
        let new_label = self.state_to_label(to, labels_config);
        self.replace_label(issue_number, &old_label, &new_label).await
      }

      fn state_to_label(&self, state: PlebState, config: &LabelConfig) -> String {
        match state {
          PlebState::Ready => config.ready.clone(),
          PlebState::Provisioning => config.provisioning.clone(),
          PlebState::Waiting => config.waiting.clone(),
          PlebState::Working => config.working.clone(),
          PlebState::Done => config.done.clone(),
        }
      }

      /// Determine current pleb state from issue labels
      pub fn get_pleb_state(&self, issue: &Issue, labels_config: &LabelConfig) -> Option<PlebState> {
        // Check which pleb label the issue has
        // Return None if no pleb label found
      }
    }
    ```

    Avoid: Don't hardcode label strings in github.rs - always use LabelConfig.
    Why: Labels are configurable, must respect user's config.
  </action>
  <verify>
    - cargo build succeeds
    - cargo clippy passes
    - PlebState enum has all states
    - transition_state compiles
    - get_pleb_state compiles
  </verify>
  <done>State machine helpers ready for orchestration phase</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cargo build --release` succeeds without errors
- [ ] `cargo clippy` passes
- [ ] All label management methods compile
- [ ] PlebState enum covers all states from config
- [ ] State transition methods use LabelConfig correctly
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No compiler warnings
- Phase 2 complete
- GitHub integration ready for orchestration
</success_criteria>

<output>
After completion, create `.planning/phases/02-github-integration/02-03-SUMMARY.md`:

# Phase 2 Plan 3: Label Management Summary

**[One-liner describing what shipped]**

## Accomplishments
- [Key outcomes]

## Files Created/Modified
- `src/github.rs` - Label management and state transitions

## Decisions Made
[Any decisions made during implementation]

## Issues Encountered
[Problems and resolutions, or "None"]

## Next Step
Phase 2 complete. Ready for Phase 3: Session Management.
</output>
